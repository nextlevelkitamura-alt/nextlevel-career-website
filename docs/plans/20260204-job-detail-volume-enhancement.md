# Implementation Plan: 求人詳細ページのボリューム拡張

## 1. Requirements Restatement

求人詳細ページの情報量を増やし、より魅力的な求人掲載を実現する。

**追加・強化する項目**:

### 給与関連
- 給与形態（月給制/時給/年俸制など）
- 昇給情報（例: 昇給年1回）
- 賞与情報（例: 賞与年2回 ※業績に準ずる）
- 交通費情報（例: 全額支給 / 一部支給 5万円/月）

### 勤務地関連
- 最寄駅（例: 札幌駅）
- 勤務地備考（例: 札幌駅徒歩5分以内）

### 職種詳細
- 詳細職種名（例: 化粧品・コスメ販売(店長・チーフ・サブ)）

### 勤務先情報
- 勤務先名（例: 株式会社〇〇商事 札幌支店）
- 住所（例: 〒060-0001 北海道札幌市中央区...）
- アクセス方法（例: JR札幌駅から徒歩5分）

### 勤務条件
- 服装・髪型（例: 私服OK / ビジネスカジュアル）
- 雇用期間（例: 長期 / 3ヶ月以上）
- 勤務開始日（例: 即日 / 4月1日〜）

**除外項目**:
- 男女比（データとしてないことが多いため）

## 2. Risk Assessment

- **LOW**: DBマイグレーション — 既に完了済み
- **LOW**: 型定義の更新 — 既に完了済み
- **MEDIUM**: 管理画面の入力フォーム拡張 — 新規フィールドの入力欄追加
- **LOW**: 求人詳細ページの表示更新 — 既存の表示パターンに追加
- **MEDIUM**: プルダウン選択肢の設計 — ユーザーとの議論が必要
- **MEDIUM**: AI抽出プロンプトの最適化 — 新規項目の抽出ルール設定

## 3. Dependencies

- Next.js 15
- Supabase（既存スキーマ、マイグレーション済み）
- Gemini 2.0 Flash API（AI抽出用）
- Tailwind CSS（スタイリング）

## 4. Implementation Phases

### Phase 1: 管理画面の入力フォーム拡張

**対象ファイル**:
- `app/admin/jobs/[id]/edit/EditJobForm.tsx`
- `app/admin/jobs/create/page.tsx`
- `components/admin/DraftJobEditor.tsx`

#### タスク

- [ ] 給与詳細セクションに以下を追加:
  - 給与形態（プルダウン or 自由入力）
  - 昇給情報（テキスト入力）
  - 賞与情報（テキスト入力）
  - 交通費情報（テキスト入力）

- [ ] 勤務地詳細セクションに以下を追加:
  - 最寄駅（テキスト入力）
  - 勤務地備考（テキスト入力）

- [ ] 職種セクションに以下を追加:
  - 詳細職種名（テキスト入力）

- [ ] 勤務先情報セクションに以下を追加:
  - 勤務先名（テキスト入力）
  - 住所（テキスト入力）
  - アクセス方法（テキスト入力）

- [ ] 勤務条件セクションに以下を追加:
  - 服装・髪型（プルダウン or 自由入力）
  - 雇用期間（プルダウン or 自由入力）
  - 勤務開始日（テキスト入力）

**注意**: 男女比フィールドは削除または非表示

### Phase 2: プルダウン選択肢の設計と実装

**対象ファイル**: 新規作成 `components/admin/JobFormOptions.tsx` または既存ファイル

#### タスク

- [ ] 給与形態の選択肢を定義:
  ```
  - 月給制
  - 日給制
  - 時給制
  - 年俸制
  - 完全歩合制
  - 其他
  ```

- [ ] 服装・髪型の選択肢を定義:
  ```
  - 私服OK
  - ビジネスカジュアル
  - スーツ
  - 制服貸与
  - ヘアセット・ネイル等の規約あり
  - 其他
  ```

- [ ] 雇用期間の選択肢を定義:
  ```
  - 長期
  - 短期（3ヶ月未満）
  - 3ヶ月以上
  - 6ヶ月以上
  - 1年未満
  - 其他
  ```

- [ ] **プルダウン or 自由入力のハイブリッド方式**:
  - 基本はプルダウン選択
  - 「その他」選択時は自由入力可能
  - 既存データとの整合性を考慮

**選択肢データの保存場所検討**:
- Supabaseの `job_options` テーブル（既存）に追加
- またはコンポーネント内の定数として管理

### Phase 3: 求人詳細ページの表示更新

**対象ファイル**: `app/jobs/[id]/page.tsx`

#### タスク

- [ ] 「給与」セクションに給与詳細を階層表示:
  - メイン給与（salary フィールド）
  - 給与形態（salary_type）
  - 昇給情報（raise_info）
  - 賞与情報（bonus_info）
  - 交通費情報（commute_allowance）

- [ ] 「求人情報テーブル」の拡張:
  - 雇用形態（既存）
  - 職種（job_category_detail を追加）
  - 給与（詳細を階層表示）
  - 勤務地（既存）
  - 最寄駅（nearest_station）
  - 勤務地備考（location_notes）

- [ ] 「勤務先情報」セクションの強化:
  - 勤務先名（workplace_name）
  - 住所（workplace_address）
  - アクセス方法（workplace_access）
  - 服装・髪型（attire）

- [ ] 「勤務条件」セクションの追加:
  - 雇用期間（period）
  - 勤務開始日（start_date）

- [ ] 空フィールドのフォールバック処理:
  - 未設定時は「確認中」またはセクションごと非表示

### Phase 4: 求人一覧ページの拡張

**対象ファイル**: `app/jobs/JobsClient.tsx` または `components/JobCard.tsx`

#### タスク

- [ ] 詳細職種名（job_category_detail）をカードに表示
- [ ] 給与詳細が設定されている場合、ヒントとして表示
- [ ] タグバッジのスタイルをピンク系に統一:
  - `bg-pink-50 text-pink-700 border border-pink-200`

### Phase 5: AI抽出プロンプトの最適化

**対象ファイル**: `app/admin/actions.ts`

#### タスク

- [ ] `extractJobDataFromFile` のプロンプトに新項目を追加:
  - JSON出力フォーマットを更新
  - 各項目の抽出ルールを明記

- [ ] 選択肢フィールドの制限:
  - プルダウン項目はAI抽出時も選択肢から選ばせる
  - 例: salary_type は「月給制/日給制/時給制/年俸制/完全歩合制/其他」から選択

- [ ] `refineJobWithAI` の対象フィールドを拡張:
  - 新規項目もAI refinementで活用

- [ ] テスト:
  - PDFアップロードで新項目が抽出されることを確認
  - プルダウン項目が選択肢内から選ばれているか確認

## 5. Estimated Complexity

- **Medium**

## 6. Critical Files

| ファイル | 変更内容 | 優先度 |
|---|---|---|
| `app/admin/jobs/[id]/edit/EditJobForm.tsx` | 管理画面フォーム拡張 | **HIGH** |
| `app/admin/jobs/create/page.tsx` | 新規作成フォーム拡張 | **HIGH** |
| `components/admin/DraftJobEditor.tsx` | ドラフト編集フォーム拡張 | **HIGH** |
| `app/jobs/[id]/page.tsx` | 求人詳細ページ表示更新 | **HIGH** |
| `app/jobs/JobsClient.tsx` | 求人一覧カード拡張 | **MEDIUM** |
| `app/admin/actions.ts` | AI抽出プロンプト更新 | **HIGH** |

## 7. 次に決めること

### プルダウン選択肢の設計

各項目について、以下を決定する必要があります：

1. **給与形態**: 月給制、日給制、時給制、年俸制、完全歩合制、其他 でOK？
2. **服装・髪型**: 私服OK、ビジネスカジュアル、スーツ、制服貸与、規約あり、其他 でOK？
3. **雇用期間**: 長期、短期、3ヶ月以上、6ヶ月以上、1年未満、其他 でOK？
4. **その他プルダウン化したい項目はある？**

### AI入力の制限

- プルダウン項目はAI抽出時に選択肢から選ばせるか？
- 自由入力項目はAIのプロンプトで制限をかけるか？（例: 文字数制限、フォーマット指定）

## 8. Notes

- 既にDBマイグレーションと型定義は完了済み
- 管理画面のフォーム拡張がメインの作業
- 求人詳細ページは既に多くのフィールドに対応済み
- 男女比は実装しない
